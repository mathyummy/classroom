<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>九年八班 數位資訊看板</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, doc, onSnapshot, updateDoc, setDoc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";

        // --- Firebase 配置 ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'classroom-908-board';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "AIzaSyAfsi-TZ8LrFfZ2Cw6w1DQNTaM_q-oiL-Q",
            authDomain: "classroom-board.firebaseapp.com",
            projectId: "classroom-board",
            storageBucket: "classroom-board.firebasestorage.app",
            messagingSenderId: "802885901626",
            appId: "1:802885901626:web:df25f12cef342c373ac403"
        };

        let db, auth, user;
        let timerInterval = null;
        let timerSeconds = 300; 
        let selectedQuoteType = 'quote'; 

        // 全域管理變數
        window.isAdmin = false; 
        const ADMIN_PASSWORD = "908"; 

        const DATES = { 
            exam: "2026-01-21", 
            mock: "2026-03-03", 
            final: "2026-05-16" 
        };

        const defaultData = {
            marquee: "九年八班數位看板已連線！管理員請點擊標題開啟編輯權限。",
            marqueeSpeed: "25s",
            homework: "1. 國文講義 P.35-P.40\n2. 英文單字 L5 小考\n3. 數學習作 3-1 完工",
            missing: [{ subject: "數學", students: [{id: "01", done: false}] }],
            important: "1. 記得帶環保餐具。\n2. 明天早自習測驗。",
            quote: "「努力不一定成功，但不努力一定很輕鬆。」",
            quoteType: "quote", 
            isMuted: false
        };

        let appData = { ...defaultData };

        // --- 功能函數 ---

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playSound(freq, type, duration, vol = 0.1) {
            if (appData.isMuted) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = type;
            osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + duration);
        }

        function updateCountdowns() {
            const calc = (dateStr) => {
                const target = new Date(dateStr).setHours(0,0,0,0);
                const now = new Date().setHours(0,0,0,0);
                const diff = Math.ceil((target - now) / 86400000);
                return diff < 0 ? 0 : diff;
            };
            const examEl = document.getElementById('exam-countdown');
            const mockEl = document.getElementById('mock-countdown');
            const finalEl = document.getElementById('final-countdown');
            if (examEl) examEl.textContent = calc(DATES.exam);
            if (mockEl) mockEl.textContent = calc(DATES.mock);
            if (finalEl) finalEl.textContent = calc(DATES.final);
        }

        function updateTimerDisplay() {
            const m = Math.floor(timerSeconds / 60).toString().padStart(2, '0');
            const s = (timerSeconds % 60).toString().padStart(2, '0');
            const el = document.getElementById('timer-display');
            if (el) el.textContent = `${m}:${s}`;
        }

        // 輔助函數：將編號上色
        function formatNumberedText(text, colorClass) {
            if (!text) return "";
            // 匹配行首的數字編號 (例如 1. 或 2、)
            return text.replace(/^(\d+[\.．、\s])/gm, `<span class="${colorClass}">$1</span>`);
        }

        function renderBoard() {
            document.getElementById('marquee-content').textContent = appData.marquee;
            
            // 修正 4: 編號顏色同步
            document.getElementById('homework-list').innerHTML = formatNumberedText(appData.homework, 'text-yellow-400');
            document.getElementById('important-note').innerHTML = formatNumberedText(appData.important, 'text-blue-400');
            
            document.getElementById('quote-display').textContent = appData.quote;
            
            const lockIcon = document.getElementById('lock-status-icon');
            const editBtnMissing = document.getElementById('btn-edit-missing');
            const mainContainer = document.body;

            if (window.isAdmin) {
                lockIcon.className = "fas fa-unlock text-emerald-400 ml-1 drop-shadow-[0_0_5px_rgba(16,185,129,0.5)]";
                if(editBtnMissing) editBtnMissing.classList.remove('hidden');
                mainContainer.classList.add('admin-active');
            } else {
                lockIcon.className = "fas fa-lock text-slate-500 ml-1";
                if(editBtnMissing) editBtnMissing.classList.add('hidden');
                mainContainer.classList.remove('admin-active');
            }

            const qTitle = document.getElementById('quote-title');
            const typeLabel = appData.quoteType === 'journal' ? '今日札記' : '今日佳句';
            qTitle.innerHTML = `<i class="fas ${appData.quoteType === 'journal' ? 'fa-pen-fancy' : 'fa-quote-left'} mr-2"></i> ${typeLabel}`;

            const mContent = document.getElementById('marquee-content');
            const speed = appData.marqueeSpeed || "25s";
            document.getElementById('speed-label').textContent = speed === "0s" ? "靜止" : speed === "40s" ? "慢" : speed === "15s" ? "快" : "一般";
            mContent.style.animation = speed === "0s" ? "none" : `marquee ${speed} linear infinite`;

            const container = document.getElementById('missing-container');
            container.innerHTML = '';
            if (!appData.missing || appData.missing.length === 0) {
                container.innerHTML = '<div class="h-full py-10 flex items-center justify-center text-emerald-400 font-black opacity-20 text-xl tracking-widest uppercase text-center">No Missing Data</div>';
            } else {
                appData.missing.forEach((item, idx) => {
                    const card = document.createElement('div');
                    card.className = "bg-white/5 backdrop-blur-sm p-3 rounded-2xl border border-white/10 mb-2 shadow-inner";
                    card.innerHTML = `
                        <div class="flex items-start gap-4">
                            <div class="text-orange-300 font-black text-base shrink-0 pt-1 w-14 border-r border-white/10">
                                ${item.subject}
                            </div>
                            <div class="flex flex-wrap gap-2 flex-1">
                                ${item.students.map((s, sIdx) => `
                                    <button onclick="window.toggleStudent('${idx}', '${sIdx}')" 
                                        class="w-10 h-10 rounded-xl font-black text-sm transition-all border 
                                        ${s.done ? 'bg-white/10 border-white/5 opacity-40 line-through text-slate-400' : 'bg-orange-500/30 border-orange-500/50 text-white active:scale-90 shadow-[0_0_10px_rgba(249,115,22,0.1)]'}
                                        hover:scale-110 active:scale-95">
                                        ${s.id}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                });
            }

            updateCountdowns();
            const muteIcon = document.getElementById('mute-icon');
            if (muteIcon) muteIcon.className = appData.isMuted ? 'fas fa-volume-mute text-rose-400' : 'fas fa-volume-up text-emerald-400';
            updateTimerDisplay();
        }

        // --- Firebase 通訊 ---
        async function init() {
            try {
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                const login = async () => {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        try {
                            return await signInWithCustomToken(auth, __initial_auth_token);
                        } catch (e) {
                            return await signInAnonymously(auth);
                        }
                    } else {
                        return await signInAnonymously(auth);
                    }
                };

                await login();

                onAuthStateChanged(auth, (u) => {
                    user = u;
                    if (user) {
                        document.getElementById('user-id-display').textContent = `UID: ${user.uid.substring(0,4)}`;
                        updateStatusUI(true);
                        setupSync();
                    }
                });
            } catch (error) {
                updateStatusUI(false);
                setTimeout(init, 3000);
            }
        }

        function setupSync() {
            if (!user) return;
            const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'boardConfig', 'main');
            onSnapshot(docRef, (snap) => {
                if (snap.exists()) {
                    appData = { ...defaultData, ...snap.data() };
                    renderBoard();
                } else {
                    setDoc(docRef, defaultData);
                }
            }, (err) => {
                updateStatusUI(false);
            });
        }

        function updateStatusUI(isOk) {
            const dot = document.getElementById('sync-status-dot');
            const text = document.getElementById('sync-status-text');
            if (dot) {
                dot.className = isOk ? 'w-1.5 h-1.5 rounded-full bg-emerald-500 shadow-[0_0_8px_#10b981] animate-pulse' : 'w-1.5 h-1.5 rounded-full bg-rose-500';
            }
            if (text) {
                text.textContent = isOk ? "ONLINE" : "OFFLINE";
                text.className = isOk ? "text-[8px] text-emerald-500/80 font-black" : "text-[8px] text-rose-500/80 font-black";
            }
        }

        // --- 全域功能掛載 ---
        window.saveData = async (update) => {
            const whitelistedKeys = ['isMuted', 'missing'];
            const isWhitelisted = Object.keys(update).every(key => whitelistedKeys.includes(key));
            if (!user || (!window.isAdmin && !isWhitelisted)) return; 
            const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'boardConfig', 'main');
            try { await updateDoc(docRef, update); } catch (e) { await setDoc(docRef, update, { merge: true }); }
        };

        window.openAdminLogin = () => {
            if (window.isAdmin) {
                document.getElementById('admin-logout-modal').classList.remove('hidden');
                document.getElementById('admin-logout-modal').classList.add('flex');
                return;
            }
            document.getElementById('admin-login-modal').classList.remove('hidden');
            document.getElementById('admin-login-modal').classList.add('flex');
            const input = document.getElementById('admin-pass-input');
            if(input) input.focus();
        };

        window.closeAdminLogin = () => {
            document.getElementById('admin-login-modal').classList.add('hidden');
            document.getElementById('admin-login-modal').classList.remove('flex');
            const input = document.getElementById('admin-pass-input');
            if(input) input.value = "";
        };

        window.handleAdminLogin = () => {
            const val = document.getElementById('admin-pass-input').value;
            if (val === ADMIN_PASSWORD) {
                window.isAdmin = true;
                renderBoard();
                window.closeAdminLogin();
            } else {
                alert("密碼錯誤！");
                const input = document.getElementById('admin-pass-input');
                if(input) input.value = "";
            }
        };

        window.closeAdminLogout = () => {
            document.getElementById('admin-logout-modal').classList.add('hidden');
            document.getElementById('admin-logout-modal').classList.remove('flex');
        };

        window.handleAdminLogout = () => {
            window.isAdmin = false;
            renderBoard();
            window.closeAdminLogout();
        };

        window.openEdit = (field, title, help = "") => {
            if (!window.isAdmin && field !== 'timer') return; 
            window.currentField = field;
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-help').textContent = help;
            
            const quoteSelector = document.getElementById('quote-selector-container');
            if (field === 'quote') {
                quoteSelector.classList.remove('hidden');
                window.setQuoteType(appData.quoteType || 'quote');
            } else {
                quoteSelector.classList.add('hidden');
            }

            let val = appData[field];
            if (field === 'missing') {
                val = (appData.missing || []).map(g => `${g.subject}：${g.students.map(s => s.id).join(', ')}`).join('\n');
            } else if (field === 'timer') {
                const m = Math.floor(timerSeconds / 60).toString().padStart(2, '0');
                const s = (timerSeconds % 60).toString().padStart(2, '0');
                val = `${m}:${s}`;
            }

            const input = document.getElementById('modal-input');
            if (input) {
                input.value = val || "";
                document.getElementById('modal').classList.remove('hidden');
                document.getElementById('modal').classList.add('flex');
                input.focus();
            }
        };

        window.closeEdit = () => {
            document.getElementById('modal').classList.add('hidden');
            document.getElementById('modal').classList.remove('flex');
        };

        window.confirmEdit = () => {
            const input = document.getElementById('modal-input');
            if (!input) return;
            const val = input.value.trim();
            const update = {};
            if (window.currentField === 'timer') {
                if (val.includes(':')) {
                    const [m, s] = val.split(':').map(x => parseInt(x) || 0);
                    timerSeconds = (m * 60) + s;
                } else { timerSeconds = (parseInt(val) || 0) * 60; }
                updateTimerDisplay();
                window.closeEdit();
                return;
            }
            if (window.currentField === 'missing') {
                update.missing = val.split('\n').filter(line => line.includes('：') || line.includes(':')).map(line => {
                    const [sub, ids] = line.split(/[：:]/);
                    return { subject: sub.trim(), students: ids.split(/[,，\s]+/).filter(i => i).map(id => ({ id: id.trim().padStart(2, '0'), done: false })) };
                });
            } else if (window.currentField === 'quote') {
                update.quote = val;
                update.quoteType = selectedQuoteType;
            } else { update[window.currentField] = val; }
            window.saveData(update);
            window.closeEdit();
        };

        window.toggleStudent = (subjectIdx, studentIdx) => {
            const updated = JSON.parse(JSON.stringify(appData.missing));
            updated[subjectIdx].students[studentIdx].done = !updated[subjectIdx].students[studentIdx].done;
            window.saveData({ missing: updated });
        };

        window.toggleTimer = () => {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
                document.getElementById('timer-btn').textContent = "開始";
            } else {
                if (timerSeconds <= 0) return;
                timerInterval = setInterval(() => {
                    timerSeconds--;
                    updateTimerDisplay();
                    if (timerSeconds <= 0) {
                        clearInterval(timerInterval);
                        timerInterval = null;
                        playSound(523.25, 'square', 1.0, 0.2); 
                        document.getElementById('timer-btn').textContent = "重置";
                    }
                }, 1000);
                document.getElementById('timer-btn').textContent = "停止";
            }
        };

        window.resetTimer = () => {
            clearInterval(timerInterval);
            timerInterval = null;
            timerSeconds = 300; 
            updateTimerDisplay();
            document.getElementById('timer-btn').textContent = "開始";
        };

        window.toggleMarqueeSpeed = (e) => {
            if (!window.isAdmin) return;
            e.stopPropagation();
            const speeds = { "25s": "40s", "40s": "15s", "15s": "0s", "0s": "25s" };
            window.saveData({ marqueeSpeed: speeds[appData.marqueeSpeed || "25s"] });
        };

        window.setQuoteType = (type) => {
            selectedQuoteType = type;
            const btnQuote = document.getElementById('btn-type-quote');
            const btnJournal = document.getElementById('btn-type-journal');
            if (type === 'quote') {
                btnQuote.className = 'flex-1 py-2 bg-indigo-600 rounded-lg font-bold border border-indigo-400 text-white';
                btnJournal.className = 'flex-1 py-2 bg-white/5 rounded-lg font-bold opacity-50 text-white';
            } else {
                btnJournal.className = 'flex-1 py-2 bg-indigo-600 rounded-lg font-bold border border-indigo-400 text-white';
                btnQuote.className = 'flex-1 py-2 bg-white/5 rounded-lg font-bold opacity-50 text-white';
            }
        };

        window.spinLucky = () => {
            const el = document.getElementById('lucky-num');
            let count = 0;
            const end = 15;
            const interval = setInterval(() => {
                const num = Math.floor(Math.random() * 25) + 1; 
                el.textContent = num.toString().padStart(2, '0');
                playSound(440, 'sine', 0.05, 0.05); 
                count++;
                if (count >= end) {
                    clearInterval(interval);
                    playSound(880, 'triangle', 0.5, 0.1); 
                }
            }, 80);
        };

        window.onload = () => {
            init();
            setInterval(() => {
                const now = new Date();
                document.getElementById('clock-display').textContent = now.toLocaleTimeString('zh-TW', { hour12: false });
                document.getElementById('date-display').textContent = now.toLocaleDateString('zh-TW', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' });
            }, 1000);
        };
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        
        html, body { 
            min-height: 100%; 
            margin: 0; 
            padding: 0; 
            overflow-x: hidden;
            font-family: 'Noto Sans TC', sans-serif;
            background: radial-gradient(circle at top right, #1a1e3b, #070912);
            color: white;
            scroll-behavior: smooth;
        }
        
        body { 
            display: flex;
            flex-direction: column;
            padding: 0.75rem;
            box-sizing: border-box;
            gap: 0.5rem;
            transition: all 0.5s ease;
        }

        .title-gradient {
            background: linear-gradient(135deg, #ffffff 0%, #a5b4fc 50%, #818cf8 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 12px rgba(129, 140, 248, 0.4));
        }

        .glass { 
            background: rgba(255, 255, 255, 0.04); 
            backdrop-filter: blur(16px); 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4), inset 0 0 10px rgba(255,255,255,0.02);
            border-radius: 1.5rem;
        }

        .countdown-glass {
            background: rgba(255, 255, 255, 0.08); 
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            padding: 0.5rem 1.25rem;
            border-radius: 1.25rem;
        }

        .editable { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; }
        .editable:hover { background: rgba(255, 255, 255, 0.08); transform: translateY(-3px); border-color: rgba(255, 255, 255, 0.25); }
        
        body.admin-active {
            background: radial-gradient(circle at top right, #1e2552, #070912);
        }

        @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        .font-num { font-family: 'Consolas', 'Monaco', monospace; }
        
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
        ::-webkit-scrollbar-track { background: transparent; }

        .content-box { min-height: 250px; }

        @media (max-width: 1023px) {
            body { gap: 1rem; padding-bottom: 2rem; }
            main { display: flex !important; flex-direction: column !important; gap: 1rem; }
            .glass { height: auto !important; min-height: auto !important; }
            header { padding-left: 0.5rem; padding-right: 0.5rem; }
            .content-box { min-height: auto; }
        }
    </style>
</head>
<body class="space-y-2">

    <!-- 管理員登入彈窗 -->
    <div id="admin-login-modal" class="fixed inset-0 bg-black/95 backdrop-blur-3xl z-[200] hidden items-center justify-center p-4">
        <div class="bg-slate-900 border border-white/20 w-full max-sm:w-full max-w-sm rounded-[2.5rem] p-8 shadow-2xl text-center">
            <div class="w-16 h-16 bg-indigo-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-[0_0_20px_rgba(79,70,229,0.5)]">
                <i class="fas fa-user-lock text-white text-2xl"></i>
            </div>
            <h3 class="text-2xl font-black text-white mb-2">管理授權</h3>
            <p class="text-slate-500 text-xs mb-6 uppercase tracking-[0.2em]">請輸入 908 班級密碼</p>
            <input type="password" id="admin-pass-input" 
                   class="w-full bg-black/50 border border-white/10 rounded-2xl px-4 py-4 text-center text-3xl font-num tracking-[0.5em] focus:outline-none focus:ring-2 focus:ring-indigo-500 mb-6 text-white"
                   placeholder="****"
                   onkeydown="if(event.key==='Enter') window.handleAdminLogin()">
            <div class="flex gap-4">
                <button onclick="window.closeAdminLogin()" class="flex-1 py-4 bg-white/5 rounded-2xl font-bold hover:bg-white/10 transition-colors text-white">取消</button>
                <button onclick="window.handleAdminLogin()" class="flex-1 py-4 bg-indigo-600 rounded-2xl font-bold hover:bg-indigo-500 transition-all text-white">解鎖編輯</button>
            </div>
        </div>
    </div>

    <!-- 登出確認彈窗 -->
    <div id="admin-logout-modal" class="fixed inset-0 bg-black/95 backdrop-blur-3xl z-[200] hidden items-center justify-center p-4">
        <div class="bg-slate-900 border border-white/20 w-full max-sm:w-full max-w-sm rounded-[2.5rem] p-8 shadow-2xl text-center text-white">
            <div class="w-16 h-16 bg-rose-600 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-[0_0_20px_rgba(225,29,72,0.4)]">
                <i class="fas fa-sign-out-alt text-white text-2xl"></i>
            </div>
            <h3 class="text-2xl font-black text-white mb-2">鎖定看板？</h3>
            <p class="text-slate-400 text-sm mb-6 leading-relaxed">鎖定後將切換為「唯讀模式」<br>學生在其他設備將無法進行編輯。</p>
            <div class="flex gap-4">
                <button onclick="window.closeAdminLogout()" class="flex-1 py-4 bg-white/5 rounded-2xl font-bold hover:bg-white/10 transition-colors">取消</button>
                <button onclick="window.handleAdminLogout()" class="flex-1 py-4 bg-rose-600 rounded-2xl font-bold hover:bg-rose-500 transition-all shadow-lg shadow-rose-900/20">確認鎖定</button>
            </div>
        </div>
    </div>

    <!-- 編輯內容彈窗 -->
    <div id="modal" class="fixed inset-0 bg-black/90 backdrop-blur-3xl z-[100] hidden items-center justify-center p-4">
        <div class="bg-slate-900/90 border border-white/20 w-full max-lg:max-w-lg rounded-[2.5rem] p-8 shadow-2xl relative text-white">
            <h3 id="modal-title" class="text-2xl font-black mb-1 text-indigo-400">編輯內容</h3>
            <p id="modal-help" class="text-slate-500 text-[11px] mb-4 whitespace-pre-wrap"></p>
            
            <div id="quote-selector-container" class="hidden mb-4 flex gap-2">
                <button id="btn-type-quote" onclick="window.setQuoteType('quote')" class="flex-1 py-2 rounded-lg font-bold transition-all">今日佳句</button>
                <button id="btn-type-journal" onclick="window.setQuoteType('journal')" class="flex-1 py-2 rounded-lg font-bold transition-all">今日札記</button>
            </div>

            <textarea id="modal-input" class="w-full h-48 bg-black/60 border border-white/10 rounded-2xl p-4 text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 text-lg mb-6 resize-none shadow-inner"></textarea>
            
            <div class="flex gap-4">
                <button onclick="window.closeEdit()" class="flex-1 py-4 bg-white/5 rounded-2xl font-bold hover:bg-white/10 transition-colors">取消</button>
                <button onclick="window.confirmEdit()" class="flex-1 py-4 bg-indigo-600 rounded-2xl font-bold hover:bg-indigo-500 shadow-lg shadow-indigo-600/30 transition-all">儲存變更</button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="py-1 px-6 flex flex-col md:flex-row justify-between items-center gap-4 shrink-0">
        <div class="flex items-center space-x-5">
            <div class="w-12 h-12 bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center rounded-2xl shrink-0 shadow-[0_0_20px_rgba(99,102,241,0.4)]">
                <i class="fas fa-desktop text-white text-xl"></i>
            </div>
            <div>
                <div class="flex items-center gap-3">
                    <div class="flex flex-col cursor-pointer transition-all hover:scale-105 active:opacity-50" onclick="window.openAdminLogin()">
                        <h1 class="text-4xl font-black tracking-tighter title-gradient leading-none pb-1">九年八班</h1>
                        <span class="text-[10px] font-black tracking-[0.4em] text-indigo-400/80 uppercase mt-1">Digital Information Board</span>
                    </div>
                    <div class="bg-white/5 px-2.5 py-1 rounded-full border border-white/10 flex items-center gap-2">
                        <div id="sync-status-dot" class="w-1.5 h-1.5 rounded-full bg-slate-500"></div>
                        <span id="sync-status-text" class="text-[8px] text-slate-500 font-black tracking-widest uppercase">READING</span>
                        <i id="lock-status-icon" class="fas fa-lock text-slate-500 ml-1 transition-all" style="font-size: 8px;"></i>
                        <span id="user-id-display" class="text-[8px] text-slate-500 font-mono hidden sm:inline opacity-40">...</span>
                    </div>
                </div>
                <div id="date-display" class="text-white font-black text-sm tracking-widest mt-1 uppercase">載入中...</div>
            </div>
        </div>

        <div class="flex flex-col md:flex-row items-center gap-4 w-full md:w-auto">
            <div class="flex gap-3 text-center">
                <div class="countdown-glass min-w-[80px]">
                    <div class="text-[9px] text-yellow-500 font-black tracking-widest uppercase mb-0.5 opacity-80">段考</div>
                    <div class="text-4xl font-num font-black text-yellow-400 drop-shadow-[0_0_12px_rgba(250,204,21,0.5)]" id="exam-countdown">--</div>
                </div>
                <div class="countdown-glass min-w-[80px]">
                    <div class="text-[9px] text-emerald-400 font-black tracking-widest uppercase mb-0.5 opacity-80">模考</div>
                    <div class="text-4xl font-num font-black text-emerald-400 drop-shadow-[0_0_12px_rgba(52,211,153,0.5)]" id="mock-countdown">--</div>
                </div>
                <div class="countdown-glass min-w-[80px]">
                    <div class="text-[9px] text-orange-500 font-black tracking-widest uppercase mb-0.5 opacity-80">會考</div>
                    <div class="text-4xl font-num font-black text-orange-500 drop-shadow-[0_0_12px_rgba(249,115,22,0.5)]" id="final-countdown">--</div>
                </div>
            </div>
            <div id="clock-display" class="text-5xl md:text-6xl font-num font-black text-white/95 ml-0 md:ml-4 tracking-tighter text-right">00:00:00</div>
        </div>
    </header>

    <!-- 跑馬燈 -->
    <div class="bg-gradient-to-r from-rose-600 via-rose-500 to-rose-600 h-14 flex items-center overflow-hidden shadow-2xl shrink-0 border-y border-rose-400/40">
        <button onclick="window.isAdmin && window.toggleMarqueeSpeed(event)" class="bg-black/30 h-full px-5 flex items-center z-10 border-r border-white/10 hover:bg-black/50 transition-all group text-white">
            <span id="speed-label" class="text-[10px] font-black uppercase tracking-tighter group-hover:scale-110 transition-transform">一般</span>
        </button>
        <div class="flex-1 overflow-hidden cursor-pointer" onclick="window.isAdmin && window.openEdit('marquee', '跑馬燈公告')">
            <div id="marquee-content" class="animate-marquee font-black text-2xl tracking-wide drop-shadow-md text-white whitespace-nowrap">載入中...</div>
        </div>
    </div>

    <!-- 主要內容區 -->
    <main class="grid grid-cols-1 lg:grid-cols-3 gap-6 flex-1 px-2 md:px-4 py-2">
        <!-- 欄位 1: 聯絡簿 -->
        <section class="flex flex-col">
            <div onclick="window.isAdmin && window.openEdit('homework', '今日聯絡簿')" class="glass p-7 flex-1 border-t-4 border-yellow-400/80 editable content-box shadow-[0_0_50px_rgba(250,204,21,0.05)] text-white">
                <h2 class="text-lg font-black text-yellow-400 mb-4 flex items-center uppercase tracking-widest"><i class="fas fa-edit mr-3"></i> 今日聯絡簿</h2>
                <!-- 修正 2: 文字縮小至 text-lg -->
                <div id="homework-list" class="text-lg font-bold leading-loose whitespace-pre-wrap text-slate-100"></div>
            </div>
        </section>

        <!-- 欄位 2: 重要提醒 + 佳句 -->
        <section class="flex flex-col gap-6">
            <div onclick="window.isAdmin && window.openEdit('important', '重要提醒')" class="glass p-7 flex-1 border-t-4 border-blue-400/80 editable content-box shadow-[0_0_50px_rgba(96,165,250,0.05)] text-white">
                <h2 class="text-lg font-black text-blue-400 mb-4 flex items-center uppercase tracking-widest"><i class="fas fa-bullhorn mr-3"></i> 重要提醒</h2>
                <!-- 修正 2: 文字縮小至 text-lg -->
                <div id="important-note" class="text-lg font-bold leading-loose text-blue-50 whitespace-pre-wrap"></div>
            </div>
            
            <!-- 修正 3: 加入 mx-auto 與 w-fit 使寬度根據內容調整 -->
            <div onclick="window.isAdmin && window.openEdit('quote', '佳句與札記', '請點選類別並輸入內容')" class="glass p-7 h-auto lg:h-56 flex flex-col justify-center items-center editable border-l-8 border-indigo-500 shrink-0 bg-indigo-950/50 shadow-xl overflow-hidden group text-white mx-auto w-fit max-w-full">
                <!-- 修正 1: 佳句標題字體加大至 text-lg -->
                <h2 id="quote-title" class="text-lg font-black text-indigo-400 uppercase tracking-[0.3em] mb-4 self-start">今日佳句</h2>
                <div class="w-full text-left opacity-20 group-hover:opacity-40 transition-opacity">
                    <i class="fas fa-quote-left text-3xl"></i>
                </div>
                <!-- 修正 2: 文字縮小至 text-lg -->
                <div id="quote-display" class="text-lg italic font-bold text-white text-center leading-relaxed px-6 drop-shadow-md"></div>
                <div class="w-full text-right opacity-20 group-hover:opacity-40 transition-opacity">
                    <i class="fas fa-quote-right text-3xl"></i>
                </div>
            </div>
        </section>

        <!-- 欄位 3: 未交名單 -->
        <section class="flex flex-col">
            <div class="glass p-7 border-t-4 border-orange-400/80 flex flex-col min-h-[300px] shadow-[0_0_50px_rgba(251,146,60,0.05)] text-white">
                <div class="flex justify-between items-center mb-5 shrink-0">
                    <h2 class="text-lg font-black text-orange-400 flex items-center uppercase tracking-widest"><i class="fas fa-user-xmark mr-3"></i> 未交名單</h2>
                    <button id="btn-edit-missing" onclick="window.openEdit('missing', '未交名單', '格式：科目：01, 05 (換行分科)')" class="hidden text-[10px] bg-white/10 px-4 py-2 rounded-xl font-black hover:bg-white/20 transition-all border border-white/5 uppercase">Edit List</button>
                </div>
                <div id="missing-container" class="space-y-2"></div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 px-2 md:px-4 py-4 shrink-0 mt-4">
        <div class="glass rounded-2xl p-4 flex items-center justify-between overflow-hidden relative group">
            <div class="z-10">
                <p class="text-indigo-400 text-[9px] font-black uppercase mb-1 tracking-[0.2em] opacity-80">Lucky (1-25)</p>
                <div id="lucky-num" class="text-3xl font-num font-black text-white drop-shadow-lg">??</div>
            </div>
            <button onclick="window.spinLucky()" class="w-11 h-11 bg-indigo-600 rounded-xl flex items-center justify-center z-10 active:scale-90 transition-all shadow-[0_0_20px_rgba(79,70,229,0.4)] hover:bg-indigo-500"><i class="fas fa-dice text-xl text-white"></i></button>
            <div class="absolute -right-2 -bottom-2 text-white/5 text-5xl font-black rotate-12 group-hover:rotate-0 transition-transform text-white">抽</div>
        </div>

        <div class="glass rounded-2xl p-4 flex items-center justify-between">
            <div class="flex-1">
                <div class="flex items-center gap-3 mb-1">
                    <p class="text-emerald-400 text-[8px] font-black uppercase tracking-[0.2em] opacity-80">Timer</p>
                    <button id="btn-mute-toggle" onclick="window.saveData({isMuted: !appData.isMuted})" class="hover:scale-110 transition-transform"><i id="mute-icon" class="fas fa-volume-up text-[10px] text-emerald-400"></i></button>
                </div>
                <div id="timer-display" onclick="window.openEdit('timer', '設定計時器', '分:秒')" 
                     class="text-3xl font-num font-black text-emerald-400 cursor-pointer drop-shadow-[0_0_10px_rgba(52,211,153,0.3)] hover:text-emerald-300 transition-colors">05:00</div>
            </div>
            <div class="flex flex-col gap-1 ml-2">
                <button id="timer-btn" onclick="window.toggleTimer()" class="bg-emerald-600 px-4 py-1.5 rounded-md font-bold text-[10px] hover:bg-emerald-500 transition-colors text-white">開始</button>
                <button onclick="window.resetTimer()" class="bg-slate-700/50 px-4 py-1.5 rounded-md font-bold text-[10px] hover:bg-slate-700 transition-colors text-white">重置</button>
            </div>
        </div>

        <a href="https://padlet.com/teacher133_5/padlet-rmnqtuy0xqgy53qh" target="_blank" class="glass rounded-2xl p-4 flex items-center space-x-4 hover:bg-white/10 active:scale-95 transition-all group">
            <div class="w-12 h-12 bg-indigo-500/20 rounded-2xl flex items-center justify-center text-indigo-300 shrink-0 group-hover:bg-indigo-500/40 transition-all"><i class="fas fa-clipboard-list text-2xl"></i></div>
            <span class="font-black text-lg text-white tracking-wide">908電子布告欄</span>
        </a>

        <a href="https://www.ycjh.hlc.edu.tw/" target="_blank" class="glass rounded-2xl p-4 flex items-center space-x-4 hover:bg-white/10 active:scale-95 transition-all group">
            <div class="w-12 h-12 bg-emerald-500/20 rounded-2xl flex items-center justify-center text-emerald-300 shrink-0 group-hover:bg-emerald-500/40 transition-all"><i class="fas fa-globe text-2xl"></i></div>
            <span class="font-black text-lg text-white tracking-wide">宜昌國中官網</span>
        </a>
    </footer>

</body>
</html>
